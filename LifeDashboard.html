<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Life Dashboard ‚Äî Fitness OS v6</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700;800&family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root{--bg0:#08080a;--bg1:#0e0e12;--bg2:#141418;--bg3:#1a1a20;--bg4:#222228;--b1:#1e1e24;--t0:#f4f4f6;--t1:#c8c8d0;--t2:#8888a0;--t3:#55556a;--lime:#b8f000;--blue:#5b9df5;--orange:#f5a623;--red:#f55353;--green:#34d399;--purple:#a78bfa;--cyan:#22d3ee;--pink:#f472b6}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'DM Sans',sans-serif;background:var(--bg0);color:var(--t0);min-height:100vh;overflow-x:hidden}
        #root{min-height:100vh}
        ::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg1)}::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px}
        textarea{font-family:inherit;resize:vertical}select{-webkit-appearance:none;appearance:none}
        input[type=number]::-webkit-inner-spin-button{opacity:1}
        @keyframes fadeIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        .sidebar{width:210px;min-height:100vh;background:var(--bg1);border-right:1px solid var(--b1);padding:20px 0;display:flex;flex-direction:column;position:fixed;left:0;top:0;bottom:0;z-index:10}
        .main{margin-left:210px;flex:1;padding:24px 28px;min-height:100vh}
        .mob-bar{display:none;position:fixed;bottom:0;left:0;right:0;background:var(--bg1);border-top:1px solid var(--b1);z-index:20;padding:6px 0 max(6px,env(safe-area-inset-bottom))}
        .mob-btn{display:none;position:fixed;top:14px;left:14px;z-index:15;background:var(--bg1);border:1px solid var(--b1);border-radius:8px;padding:8px 12px;color:var(--t0);font-size:1.1rem;cursor:pointer}
        .sidebar-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:9}
        @media(max-width:768px){
            .sidebar{transform:translateX(-100%);transition:transform 0.3s ease;z-index:20}
            .sidebar.open{transform:translateX(0)}
            .sidebar-overlay.open{display:block;z-index:19}
            .main{margin-left:0;padding:16px 12px;padding-bottom:80px;padding-top:56px}
            .mob-bar{display:flex;justify-content:space-around;align-items:center}
            .mob-btn{display:block}
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;
        const uid = () => "_" + Math.random().toString(36).slice(2, 8);
        const fmtD = d => d.toISOString().split("T")[0];
        const todayS = () => fmtD(new Date());
        const DOWS = ["Lun", "Mar", "Mi√©", "Jue", "Vie", "S√°b", "Dom"];
        const KEY = "life-dashboard";

        const C = { bg0: "#08080a", bg1: "#0e0e12", bg2: "#141418", bg3: "#1a1a20", bg4: "#222228", b1: "#1e1e24", t0: "#f4f4f6", t1: "#c8c8d0", t2: "#8888a0", t3: "#55556a", lime: "#b8f000", blue: "#5b9df5", orange: "#f5a623", red: "#f55353", green: "#34d399", purple: "#a78bfa", cyan: "#22d3ee", pink: "#f472b6" };
        
        const z = {
            card: { background: C.bg1, border: `1px solid ${C.b1}`, borderRadius: 14, padding: "16px", marginBottom: 14 },
            lb: { fontSize: "0.6rem", textTransform: "uppercase", letterSpacing: 2, color: C.t3, fontWeight: 600, marginBottom: 8 },
            big: { fontFamily: "'IBM Plex Mono',monospace", fontSize: "1.6rem", fontWeight: 700, lineHeight: 1 },
            btn: p => ({ padding: "8px 16px", borderRadius: 8, border: p ? "none" : `1px solid ${C.b1}`, fontWeight: 600, fontSize: "0.78rem", cursor: "pointer", fontFamily: "inherit", background: p ? C.lime : C.bg2, color: p ? C.bg0 : C.t1, whiteSpace: "nowrap" }),
            btnS: p => ({ padding: "5px 11px", borderRadius: 6, border: p ? "none" : `1px solid ${C.b1}`, fontWeight: 600, fontSize: "0.7rem", cursor: "pointer", fontFamily: "inherit", background: p ? C.lime : C.bg2, color: p ? C.bg0 : C.t2 }),
            btnD: { padding: "5px 11px", borderRadius: 6, border: "1px solid #f5535333", fontWeight: 600, fontSize: "0.7rem", cursor: "pointer", fontFamily: "inherit", background: "transparent", color: C.red },
            inp: { width: "100%", padding: "9px 14px", borderRadius: 8, border: `1px solid ${C.b1}`, background: C.bg0, color: C.t0, fontSize: "0.82rem", fontFamily: "inherit", outline: "none" },
            inpM: { width: "100%", padding: "8px 12px", borderRadius: 8, border: `1px solid ${C.b1}`, background: C.bg0, color: C.t0, fontSize: "0.8rem", fontFamily: "'IBM Plex Mono',monospace", outline: "none" },
            tag: c => ({ fontSize: "0.6rem", padding: "3px 8px", borderRadius: 100, fontWeight: 600, background: c + "18", color: c, display: "inline-block" }),
            th: { fontSize: "0.52rem", textTransform: "uppercase", letterSpacing: 1.5, color: C.t3, fontWeight: 600, padding: "6px 4px", textAlign: "left", borderBottom: `1px solid ${C.b1}` },
            td: { padding: "6px 4px", fontSize: "0.76rem", borderBottom: `1px solid ${C.b1}` }
        };

        /* === COMPONENTES GLOBALES (FUERA DE LAS P√ÅGINAS PARA EVITAR P√âRDIDA DE FOCO) === */

        const Mdl = ({ title, ch, onClose, wide }) => (
            <div style={{ position: "fixed", inset: 0, background: "rgba(0,0,0,0.65)", zIndex: 200, display: "flex", alignItems: "center", justifyContent: "center", backdropFilter: "blur(4px)", padding: 12 }} onClick={onClose}>
                <div style={{ background: C.bg1, border: `1px solid ${C.b1}`, borderRadius: 16, padding: "20px", width: "100%", maxWidth: wide ? 720 : 540, maxHeight: "90vh", overflowY: "auto" }} onClick={e => e.stopPropagation()}>
                    <div style={{ fontSize: "1rem", fontWeight: 700, marginBottom: 16 }}>{title}</div>
                    {ch}
                </div>
            </div>
        );

        const G2 = ({ children }) => (<div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>{children}</div>);
        const G3 = ({ children }) => (<div style={{ display: "grid", gridTemplateColumns: "repeat(auto-fit,minmax(140px,1fr))", gap: 10 }}>{children}</div>);

        /* Modales de Fitness */
        const FlModal = ({ idx, ex, dayTypes, dayN, sv, D, onClose }) => {
            const [f, setF] = useState(ex || { date: todayS(), week: `S${Math.ceil(dayN / 7)}`, dayType: "dt2", weight: "", waist: "", cal: "", prot: "", fat: "", carbs: "", sugar: "", steps: "", sleep: "", notes: "" });
            const dt = dayTypes.find(t => t.id === f.dayType) || dayTypes[0];
            const submit = () => {
                const log = [...D.fitnessLog];
                if (idx !== null) log[idx] = { ...f };
                else log.push({ ...f });
                log.sort((a, b) => a.date.localeCompare(b.date));
                sv({ ...D, fitnessLog: log });
                onClose();
            };
            return (
                <Mdl title={idx !== null ? "Editar Registro" : "üìä Nuevo Registro"} onClose={onClose} wide ch={
                    <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
                        <G3>
                            <div><div style={z.lb}>Fecha</div><input type="date" style={z.inpM} value={f.date} onChange={e => setF({ ...f, date: e.target.value })} /></div>
                            <div><div style={z.lb}>Tipo D√≠a</div>
                                <select style={z.inpM} value={f.dayType} onChange={e => setF({ ...f, dayType: e.target.value })}>
                                    {dayTypes.map(t => <option key={t.id} value={t.id}>{t.emoji} {t.name}</option>)}
                                </select>
                            </div>
                            <div><div style={z.lb}>Peso (kg)</div><input type="number" step="0.1" style={z.inpM} value={f.weight} onChange={e => setF({ ...f, weight: e.target.value })} /></div>
                        </G3>
                        <G3>
                            <div><div style={z.lb}>Calor√≠as</div><input type="number" style={z.inpM} value={f.cal} onChange={e => setF({ ...f, cal: e.target.value })} /></div>
                            <div><div style={z.lb}>Prot (g)</div><input type="number" style={z.inpM} value={f.prot} onChange={e => setF({ ...f, prot: e.target.value })} /></div>
                            <div><div style={z.lb}>Carbs (g)</div><input type="number" style={z.inpM} value={f.carbs} onChange={e => setF({ ...f, carbs: e.target.value })} /></div>
                            <div><div style={z.lb}>Grasas (g)</div><input type="number" style={z.inpM} value={f.fat} onChange={e => setF({ ...f, fat: e.target.value })} /></div>
                        </G3>
                        <div style={{ padding: 10, background: C.bg2, borderRadius: 8, fontSize: "0.7rem", color: C.t2 }}>
                            Objetivo {dt.name}: {dt.cal} kcal | {dt.prot}P {dt.carbs}C {dt.fat}G
                        </div>
                        <div style={{ display: "flex", gap: 8 }}>
                            <button style={z.btn(true)} onClick={submit}>Guardar</button>
                            <button style={z.btn(false)} onClick={onClose}>Cancelar</button>
                        </div>
                    </div>
                } />
            );
        };

        /* Modal de Proyectos */
        const ProjEdit = ({ ex, idx, projects, sv, D, onClose }) => {
            const [f, setF] = useState({ ...ex });
            const save = () => {
                const p = [...projects];
                p[idx] = f;
                sv({ ...D, projects: p });
                onClose();
            };
            return (
                <Mdl title="‚úèÔ∏è Editar Proyecto" onClose={onClose} ch={
                    <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
                        <div><div style={z.lb}>Nombre</div><input style={z.inp} value={f.name} onChange={e => setF({ ...f, name: e.target.value })} /></div>
                        <G2>
                            <div><div style={z.lb}>Status</div>
                                <select style={z.inpM} value={f.status} onChange={e => setF({ ...f, status: e.target.value })}>
                                    <option>En progreso</option><option>Pausado</option><option>Completado</option>
                                </select>
                            </div>
                            <div><div style={z.lb}>Progreso %</div><input type="number" style={z.inpM} value={f.progress} onChange={e => setF({ ...f, progress: e.target.value })} /></div>
                        </G2>
                        <button style={z.btn(true)} onClick={save}>Guardar Cambios</button>
                    </div>
                } />
            );
        };

        /* === DEFAULTS & LOGIC === */
        const DEF_S = { planName: "Mini-Cut 6 Semanas", startDate: "2026-02-01", cutWeeks: 6, startWeight: 73.7, goalWeight: 71.0, trainingPerWeek: 5 };
        const DEF_DT = [
            { id: "dt1", name: "Descanso", emoji: "üò¥", cal: 2250, prot: 170, carbs: 220, fat: 65 },
            { id: "dt2", name: "Pesas", emoji: "üèãÔ∏è", cal: 2350, prot: 180, carbs: 260, fat: 65 }
        ];

        /* === APP PRINCIPAL === */
        function App() {
            const [D, setD] = useState(null);
            const [pg, setPg] = useState("dashboard");
            const [modal, setModal] = useState(null);

            useEffect(() => {
                const s = localStorage.getItem(KEY);
                if (s) setD(JSON.parse(s));
                else setD({ settings: DEF_S, dayTypes: DEF_DT, fitnessLog: [], projects: [], habits: [], books: [], horario: [] });
            }, []);

            const sv = useCallback(nd => { setD(nd); localStorage.setItem(KEY, JSON.stringify(nd)); }, []);

            if (!D) return null;

            const dayN = Math.max(1, Math.floor((new Date() - new Date(D.settings.startDate)) / 86400000) + 1);

            return (
                <div style={{ display: "flex" }}>
                    {/* Sidebar */}
                    <div className="sidebar">
                        <div style={{ padding: "0 20px 20px", fontSize: "1.1rem", fontWeight: 800, color: C.lime }}>FITNESS OS</div>
                        {["dashboard", "fitness", "projects", "habits", "horario", "lectura"].map(id => (
                            <div key={id} onClick={() => setPg(id)} style={{ padding: "10px 20px", cursor: "pointer", color: pg === id ? C.lime : C.t2, background: pg === id ? C.lime + "10" : "transparent" }}>
                                {id.toUpperCase()}
                            </div>
                        ))}
                    </div>

                    {/* Main Content */}
                    <div className="main">
                        {pg === "dashboard" && <Dashboard D={D} dayN={dayN} />}
                        {pg === "fitness" && <Fitness D={D} sv={sv} dayN={dayN} setModal={setModal} />}
                        {pg === "projects" && <Projects D={D} sv={sv} setModal={setModal} />}
                        {pg === "habits" && <div>P√°gina de H√°bitos</div>}
                        
                        {/* Renderizado de Modales */}
                        {modal?.type === "fit" && <FlModal idx={modal.idx} ex={modal.ex} dayTypes={D.dayTypes} dayN={dayN} sv={sv} D={D} onClose={() => setModal(null)} />}
                        {modal?.type === "proj" && <ProjEdit idx={modal.idx} ex={modal.ex} projects={D.projects} sv={sv} D={D} onClose={() => setModal(null)} />}
                    </div>
                </div>
            );
        }

        const Dashboard = ({ D, dayN }) => (
            <div style={{ animation: "fadeIn 0.4s ease" }}>
                <h2 style={{ marginBottom: 20 }}>D√≠a {dayN} de {D.settings.cutWeeks * 7}</h2>
                <G3>
                    <div style={z.card}><div style={z.lb}>Plan</div><div style={z.big}>{D.settings.planName}</div></div>
                    <div style={z.card}><div style={z.lb}>Peso Inicial</div><div style={z.big}>{D.settings.startWeight} kg</div></div>
                </G3>
            </div>
        );

        const Fitness = ({ D, setModal }) => (
            <div>
                <div style={{ display: "flex", justifyContent: "space-between", marginBottom: 20 }}>
                    <h2>Fitness Log</h2>
                    <button style={z.btn(true)} onClick={() => setModal({ type: "fit", idx: null })}>+ Registro</button>
                </div>
                <div style={z.card}>
                    <table style={{ width: "100%", borderCollapse: "collapse" }}>
                        <thead>
                            <tr>
                                <th style={z.th}>Fecha</th>
                                <th style={z.th}>Tipo</th>
                                <th style={z.th}>Peso</th>
                                <th style={z.th}>Cal</th>
                                <th style={z.th}>Acci√≥n</th>
                            </tr>
                        </thead>
                        <tbody>
                            {D.fitnessLog.map((e, i) => (
                                <tr key={i}>
                                    <td style={z.td}>{e.date}</td>
                                    <td style={z.td}>{e.dayType}</td>
                                    <td style={z.td}>{e.weight} kg</td>
                                    <td style={z.td}>{e.cal}</td>
                                    <td style={z.td}><button style={z.btnS(false)} onClick={() => setModal({ type: "fit", idx: i, ex: e })}>Editar</button></td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            </div>
        );

        const Projects = ({ D, setModal }) => (
            <G2>
                {D.projects.map((p, i) => (
                    <div key={i} style={z.card}>
                        <div style={{ display: "flex", justifyContent: "space-between" }}>
                            <h3>{p.name}</h3>
                            <button style={z.btnS(false)} onClick={() => setModal({ type: "proj", idx: i, ex: p })}>‚úèÔ∏è</button>
                        </div>
                        <div style={{ marginTop: 10, height: 6, background: C.bg3, borderRadius: 3 }}>
                            <div style={{ height: "100%", width: `${p.progress}%`, background: C.lime, borderRadius: 3 }} />
                        </div>
                        <p style={{ fontSize: "0.7rem", marginTop: 5, color: C.t2 }}>{p.status} ‚Äî {p.progress}%</p>
                    </div>
                ))}
            </G2>
        );

        const root = ReactDOM.createRoot(document.getElementById("root"));
        root.render(<App />);
    </script>
</body>
</html>
